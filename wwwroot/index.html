<!DOCTYPE html>
<html lang="en" data-theme="light" data-hand="standard">
<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Marian Consecration</title>

    <base href="/" />

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            const savedLang = localStorage.getItem('language') || 'modern';
            const savedHand = localStorage.getItem('hand') || 'standard';

            document.documentElement.setAttribute('data-theme', savedTheme);
            document.documentElement.setAttribute('data-hand', savedHand);

            window.setTheme = (theme) => {
                document.documentElement.setAttribute('data-theme', theme);
                localStorage.setItem('theme', theme);
            };
            window.setHand = (hand) => {
                document.documentElement.setAttribute('data-hand', hand);
                localStorage.setItem('hand', hand);
            };
        });
    </script>

    <link rel="stylesheet" href="lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" href="favicon.png" />
    <link rel="icon" href="favicon.ico" sizes="any">
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link href="MarianConsecration.styles.css" rel="stylesheet" />
    <link href="manifest.webmanifest" rel="manifest" />
    <link rel="stylesheet" href="_content/Radzen.Blazor/css/material.css" />

</head>
<body>
    <div id="app">
        <div id="loading-overlay">
            <div class="spinner"></div>
            <div class="loading-text">Loading Marian Consecration</div>
        </div>
    </div>

    <div id="blazor-error-ui" class="d-none">
        <div class="alert alert-danger">
            An unhandled error has occurred.
            <a href="" class="reload">Reload</a>
            <span class="dismiss">Ã—</span>
        </div>
    </div>

    <script src="_content/Radzen.Blazor/js/Radzen.Blazor.js"></script>

    <script>
        (function () {
            var redirect = sessionStorage.getItem('redirect');
            if (redirect) {
                sessionStorage.removeItem('redirect');
                // Check if the current path (which will be '/' after 404.html redirect)
                // is different from the intended path.
                if (window.location.pathname !== redirect.split('?')[0].split('#')[0] ||
                    window.location.search !== (redirect.includes('?') ? redirect.substring(redirect.indexOf('?'), (redirect.includes('#') ? redirect.indexOf('#') : redirect.length)) : '') ||
                    window.location.hash !== (redirect.includes('#') ? redirect.substring(redirect.indexOf('#')) : '')) {
                    // Replace the current history state with the correct URL.
                    // Blazor will then pick this up when it initializes.
                    window.history.replaceState(null, null, redirect);
                }
            }
        })();
    </script>
    <script src="_framework/blazor.webassembly.js"></script>
    <script>
        // Service worker registration for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(registration => {
                    console.log('Service Worker registered with scope:', registration.scope);
                }).catch(error => {
                    console.log('Service Worker registration failed:', error);
                });
        }

        window.addEventListener('load', function () {
            const errorUi = document.getElementById('blazor-error-ui');
            if (errorUi) {
                errorUi.querySelector('.reload').onclick = function () {
                    location.reload();
                };
                errorUi.querySelector('.dismiss').onclick = function () {
                    errorUi.classList.add('d-none');
                };
            }
        });
    </script>
</body>
</html>
